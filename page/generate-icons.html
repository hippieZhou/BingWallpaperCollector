<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWAå›¾æ ‡ç”Ÿæˆå™¨ - Bingå£çº¸æ”¶é›†å™¨</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .icon-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px 0;
    }

    .icon-item {
      text-align: center;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 2px solid #ddd;
    }

    .icon-item img {
      display: block;
      margin: 0 auto 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .download-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
      margin-top: 5px;
    }

    .download-btn:hover {
      background: #0056b3;
    }

    .instructions {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ¨ PWAå›¾æ ‡ç”Ÿæˆå™¨</h1>
    <p>ä¸º Bingå£çº¸æ”¶é›†å™¨ PWA ç”Ÿæˆä¸åŒå°ºå¯¸çš„åº”ç”¨å›¾æ ‡ã€‚</p>

    <div class="warning">
      <strong>âš ï¸ æ³¨æ„ï¼š</strong> è¿™ä¸ªå·¥å…·éœ€è¦åœ¨æ”¯æŒCanvas APIçš„ç°ä»£æµè§ˆå™¨ä¸­è¿è¡Œã€‚ç”Ÿæˆçš„å›¾æ ‡å°†åŸºäºæˆ‘ä»¬çš„SVGè®¾è®¡ã€‚
    </div>

    <div class="instructions">
      <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</h3>
      <ol>
        <li>ç‚¹å‡»ä¸‹æ–¹çš„"ç”Ÿæˆæ‰€æœ‰å›¾æ ‡"æŒ‰é’®</li>
        <li>ç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„å°ºå¯¸å›¾æ ‡</li>
        <li>ç‚¹å‡»å„ä¸ªå›¾æ ‡ä¸‹æ–¹çš„ä¸‹è½½æŒ‰é’®ä¿å­˜åˆ°æœ¬åœ°</li>
        <li>å°†ç”Ÿæˆçš„PNGæ–‡ä»¶ä¸Šä¼ åˆ° <code>page/assets/images/</code> ç›®å½•</li>
        <li>ç¡®ä¿æ–‡ä»¶åæ ¼å¼ä¸º <code>icon-{å°ºå¯¸}x{å°ºå¯¸}.png</code></li>
      </ol>
    </div>

    <button onclick="generateAllIcons()"
      style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 20px 0;">
      ğŸš€ ç”Ÿæˆæ‰€æœ‰å›¾æ ‡
    </button>

    <div id="iconContainer" class="icon-preview"></div>

    <div class="instructions">
      <h3>ğŸ”§ æ‰‹åŠ¨æ–¹æ³•ï¼ˆæ¨èï¼‰ï¼š</h3>
      <p>å¦‚æœä¸Šè¿°è‡ªåŠ¨ç”Ÿæˆé‡åˆ°é—®é¢˜ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
      <ol>
        <li>ä½¿ç”¨ <strong>Adobe Illustrator</strong>ã€<strong>Inkscape</strong> æˆ–åœ¨çº¿SVGè½¬PNGå·¥å…·</li>
        <li>æ‰“å¼€ <code>assets/images/app-icon.svg</code> æ–‡ä»¶</li>
        <li>å¯¼å‡ºä¸ºä»¥ä¸‹å°ºå¯¸çš„PNGæ–‡ä»¶ï¼š
          <ul>
            <li>icon-72x72.png (72Ã—72)</li>
            <li>icon-96x96.png (96Ã—96)</li>
            <li>icon-128x128.png (128Ã—128)</li>
            <li>icon-144x144.png (144Ã—144)</li>
            <li>icon-152x152.png (152Ã—152)</li>
            <li>icon-192x192.png (192Ã—192)</li>
            <li>icon-384x384.png (384Ã—384)</li>
            <li>icon-512x512.png (512Ã—512)</li>
          </ul>
        </li>
        <li>ç¡®ä¿PNGæ–‡ä»¶è´¨é‡è¾ƒé«˜ï¼ŒèƒŒæ™¯é€æ˜æˆ–ç™½è‰²</li>
      </ol>
    </div>

    <div class="instructions">
      <h3>ğŸŒ åœ¨çº¿å·¥å…·æ¨èï¼š</h3>
      <ul>
        <li><strong>RealFaviconGenerator</strong>: <a href="https://realfavicongenerator.net/"
            target="_blank">https://realfavicongenerator.net/</a></li>
        <li><strong>PWA Builder</strong>: <a href="https://www.pwabuilder.com/"
            target="_blank">https://www.pwabuilder.com/</a></li>
        <li><strong>Favicon.io</strong>: <a href="https://favicon.io/" target="_blank">https://favicon.io/</a></li>
        <li><strong>Canva</strong>: <a href="https://www.canva.com/" target="_blank">https://www.canva.com/</a></li>
      </ul>
    </div>
  </div>

  <script>
    const iconSizes = [72, 96, 128, 144, 152, 192, 384, 512];

    async function generateAllIcons() {
      const container = document.getElementById('iconContainer');
      container.innerHTML = '<p>æ­£åœ¨ç”Ÿæˆå›¾æ ‡...</p>';

      try {
        // åŠ è½½SVG
        const svgResponse = await fetch('./assets/images/app-icon.svg');
        const svgText = await svgResponse.text();

        const iconElements = [];

        for (const size of iconSizes) {
          const iconElement = await generateIcon(svgText, size);
          iconElements.push(iconElement);
        }

        container.innerHTML = '';
        iconElements.forEach(element => container.appendChild(element));

      } catch (error) {
        console.error('ç”Ÿæˆå›¾æ ‡å¤±è´¥:', error);
        container.innerHTML = `
                    <div class="warning">
                        <strong>âŒ ç”Ÿæˆå¤±è´¥ï¼š</strong> ${error.message}<br>
                        è¯·å°è¯•ä½¿ç”¨æ‰‹åŠ¨æ–¹æ³•æˆ–åœ¨çº¿å·¥å…·ã€‚
                    </div>
                `;
      }
    }

    async function generateIcon(svgText, size) {
      return new Promise((resolve, reject) => {
        try {
          // åˆ›å»ºSVGå…ƒç´ 
          const svg = new DOMParser().parseFromString(svgText, 'image/svg+xml').documentElement;
          svg.setAttribute('width', size);
          svg.setAttribute('height', size);

          // åˆ›å»ºcanvas
          const canvas = document.createElement('canvas');
          canvas.width = size;
          canvas.height = size;
          const ctx = canvas.getContext('2d');

          // åˆ›å»ºå›¾åƒ
          const img = new Image();
          const svgBlob = new Blob([new XMLSerializer().serializeToString(svg)], { type: 'image/svg+xml' });
          const url = URL.createObjectURL(svgBlob);

          img.onload = function () {
            // ç»˜åˆ¶åˆ°canvas
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, size, size);
            ctx.drawImage(img, 0, 0, size, size);

            // è½¬æ¢ä¸ºPNG
            canvas.toBlob(function (blob) {
              const pngUrl = URL.createObjectURL(blob);

              // åˆ›å»ºå±•ç¤ºå…ƒç´ 
              const iconDiv = document.createElement('div');
              iconDiv.className = 'icon-item';
              iconDiv.innerHTML = `
                                <img src="${pngUrl}" alt="${size}x${size} icon" style="width: ${Math.min(size, 128)}px; height: ${Math.min(size, 128)}px;">
                                <div><strong>${size}Ã—${size}</strong></div>
                                <button class="download-btn" onclick="downloadIcon('${pngUrl}', 'icon-${size}x${size}.png')">
                                    ğŸ’¾ ä¸‹è½½
                                </button>
                            `;

              URL.revokeObjectURL(url);
              resolve(iconDiv);
            }, 'image/png');
          };

          img.onerror = function () {
            reject(new Error(`æ— æ³•åŠ è½½ ${size}Ã—${size} å›¾æ ‡`));
          };

          img.src = url;

        } catch (error) {
          reject(error);
        }
      });
    }

    function downloadIcon(url, filename) {
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  </script>
</body>

</html>
