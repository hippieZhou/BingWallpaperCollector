<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA图标生成器 - Bing壁纸收集器</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .icon-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px 0;
    }

    .icon-item {
      text-align: center;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 2px solid #ddd;
    }

    .icon-item img {
      display: block;
      margin: 0 auto 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .download-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
      margin-top: 5px;
    }

    .download-btn:hover {
      background: #0056b3;
    }

    .instructions {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>🎨 PWA图标生成器</h1>
    <p>为 Bing壁纸收集器 PWA 生成不同尺寸的应用图标。</p>

    <div class="warning">
      <strong>⚠️ 注意：</strong> 这个工具需要在支持Canvas API的现代浏览器中运行。生成的图标将基于我们的SVG设计。
    </div>

    <div class="instructions">
      <h3>📋 使用说明：</h3>
      <ol>
        <li>点击下方的"生成所有图标"按钮</li>
        <li>系统将自动生成所有需要的尺寸图标</li>
        <li>点击各个图标下方的下载按钮保存到本地</li>
        <li>将生成的PNG文件上传到 <code>page/assets/images/</code> 目录</li>
        <li>确保文件名格式为 <code>icon-{尺寸}x{尺寸}.png</code></li>
      </ol>
    </div>

    <button onclick="generateAllIcons()"
      style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 20px 0;">
      🚀 生成所有图标
    </button>

    <div id="iconContainer" class="icon-preview"></div>

    <div class="instructions">
      <h3>🔧 手动方法（推荐）：</h3>
      <p>如果上述自动生成遇到问题，您也可以使用以下方法：</p>
      <ol>
        <li>使用 <strong>Adobe Illustrator</strong>、<strong>Inkscape</strong> 或在线SVG转PNG工具</li>
        <li>打开 <code>assets/images/app-icon.svg</code> 文件</li>
        <li>导出为以下尺寸的PNG文件：
          <ul>
            <li>icon-72x72.png (72×72)</li>
            <li>icon-96x96.png (96×96)</li>
            <li>icon-128x128.png (128×128)</li>
            <li>icon-144x144.png (144×144)</li>
            <li>icon-152x152.png (152×152)</li>
            <li>icon-192x192.png (192×192)</li>
            <li>icon-384x384.png (384×384)</li>
            <li>icon-512x512.png (512×512)</li>
          </ul>
        </li>
        <li>确保PNG文件质量较高，背景透明或白色</li>
      </ol>
    </div>

    <div class="instructions">
      <h3>🌐 在线工具推荐：</h3>
      <ul>
        <li><strong>RealFaviconGenerator</strong>: <a href="https://realfavicongenerator.net/"
            target="_blank">https://realfavicongenerator.net/</a></li>
        <li><strong>PWA Builder</strong>: <a href="https://www.pwabuilder.com/"
            target="_blank">https://www.pwabuilder.com/</a></li>
        <li><strong>Favicon.io</strong>: <a href="https://favicon.io/" target="_blank">https://favicon.io/</a></li>
        <li><strong>Canva</strong>: <a href="https://www.canva.com/" target="_blank">https://www.canva.com/</a></li>
      </ul>
    </div>
  </div>

  <script>
    const iconSizes = [72, 96, 128, 144, 152, 192, 384, 512];

    async function generateAllIcons() {
      const container = document.getElementById('iconContainer');
      container.innerHTML = '<p>正在生成图标...</p>';

      try {
        // 加载SVG
        const svgResponse = await fetch('./assets/images/app-icon.svg');
        const svgText = await svgResponse.text();

        const iconElements = [];

        for (const size of iconSizes) {
          const iconElement = await generateIcon(svgText, size);
          iconElements.push(iconElement);
        }

        container.innerHTML = '';
        iconElements.forEach(element => container.appendChild(element));

      } catch (error) {
        console.error('生成图标失败:', error);
        container.innerHTML = `
                    <div class="warning">
                        <strong>❌ 生成失败：</strong> ${error.message}<br>
                        请尝试使用手动方法或在线工具。
                    </div>
                `;
      }
    }

    async function generateIcon(svgText, size) {
      return new Promise((resolve, reject) => {
        try {
          // 创建SVG元素
          const svg = new DOMParser().parseFromString(svgText, 'image/svg+xml').documentElement;
          svg.setAttribute('width', size);
          svg.setAttribute('height', size);

          // 创建canvas
          const canvas = document.createElement('canvas');
          canvas.width = size;
          canvas.height = size;
          const ctx = canvas.getContext('2d');

          // 创建图像
          const img = new Image();
          const svgBlob = new Blob([new XMLSerializer().serializeToString(svg)], { type: 'image/svg+xml' });
          const url = URL.createObjectURL(svgBlob);

          img.onload = function () {
            // 绘制到canvas
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, size, size);
            ctx.drawImage(img, 0, 0, size, size);

            // 转换为PNG
            canvas.toBlob(function (blob) {
              const pngUrl = URL.createObjectURL(blob);

              // 创建展示元素
              const iconDiv = document.createElement('div');
              iconDiv.className = 'icon-item';
              iconDiv.innerHTML = `
                                <img src="${pngUrl}" alt="${size}x${size} icon" style="width: ${Math.min(size, 128)}px; height: ${Math.min(size, 128)}px;">
                                <div><strong>${size}×${size}</strong></div>
                                <button class="download-btn" onclick="downloadIcon('${pngUrl}', 'icon-${size}x${size}.png')">
                                    💾 下载
                                </button>
                            `;

              URL.revokeObjectURL(url);
              resolve(iconDiv);
            }, 'image/png');
          };

          img.onerror = function () {
            reject(new Error(`无法加载 ${size}×${size} 图标`));
          };

          img.src = url;

        } catch (error) {
          reject(error);
        }
      });
    }

    function downloadIcon(url, filename) {
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  </script>
</body>

</html>
