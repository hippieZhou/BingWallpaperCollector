<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ˜¾ç¤ºè¯Šæ–­</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .test-section { margin-bottom: 30px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
        .image-test { margin: 10px 0; }
        .image-test img { max-width: 300px; height: auto; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        .result { margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ğŸ” å›¾ç‰‡æ˜¾ç¤ºè¯Šæ–­</h1>
    
    <div class="test-section">
        <h2>1. æµ‹è¯•Bingç›´æ¥å›¾ç‰‡URL</h2>
        <div id="bing-test"></div>
    </div>
    
    <div class="test-section">
        <h2>2. æµ‹è¯•Referrerç­–ç•¥</h2>
        <div id="referrer-test"></div>
    </div>
    
    <div class="test-section">
        <h2>3. æµ‹è¯•CORSç­–ç•¥</h2>
        <div id="cors-test"></div>
    </div>
    
    <div class="test-section">
        <h2>4. æµ‹è¯•å ä½å›¾ç‰‡</h2>
        <div id="placeholder-test"></div>
    </div>

    <script>
        // æµ‹è¯•Bingå›¾ç‰‡URL
        async function testBingImages() {
            const container = document.getElementById('bing-test');
            
            try {
                // è·å–ä¸€ä¸ªæ ·æœ¬æ•°æ®æ–‡ä»¶
                const response = await fetch('/archive/China/2025-08-29.json');
                const data = await response.json();
                
                if (data.imageResolutions && data.imageResolutions.length > 0) {
                    const hdImage = data.imageResolutions.find(img => img.resolution === 'HD');
                    const imageUrl = hdImage ? hdImage.url : data.imageResolutions[0].url;
                    
                    container.innerHTML = `
                        <div class="info">æµ‹è¯•å›¾ç‰‡URL: ${imageUrl}</div>
                        <div class="image-test">
                            <img src="${imageUrl}" alt="Bingå£çº¸æµ‹è¯•" 
                                 onload="logImageSuccess('bing', '${imageUrl}')" 
                                 onerror="logImageError('bing', '${imageUrl}', this)">
                        </div>
                        <div id="bing-result" class="result">åŠ è½½ä¸­...</div>
                    `;
                } else {
                    container.innerHTML = '<div class="error">æ— æ³•è·å–å›¾ç‰‡æ•°æ®</div>';
                }
            } catch (error) {
                container.innerHTML = `<div class="error">è·å–æ•°æ®å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•Referrerç­–ç•¥
        function testReferrerPolicy() {
            const container = document.getElementById('referrer-test');
            const testUrl = 'https://www.bing.com/th?id=OHR.PlazaMayor_ZH-CN4576498488_1920x1200.jpg';
            
            container.innerHTML = `
                <div class="info">æµ‹è¯•ä¸åŒreferrerç­–ç•¥</div>
                <div class="image-test">
                    <p>no-referrer:</p>
                    <img src="${testUrl}" referrerpolicy="no-referrer" alt="no-referreræµ‹è¯•"
                         onload="logImageSuccess('no-referrer', '${testUrl}')" 
                         onerror="logImageError('no-referrer', '${testUrl}', this)">
                </div>
                <div class="image-test">
                    <p>origin:</p>
                    <img src="${testUrl}" referrerpolicy="origin" alt="originæµ‹è¯•"
                         onload="logImageSuccess('origin', '${testUrl}')" 
                         onerror="logImageError('origin', '${testUrl}', this)">
                </div>
                <div id="referrer-result" class="result">æµ‹è¯•ä¸­...</div>
            `;
        }
        
        // æµ‹è¯•CORS
        async function testCORS() {
            const container = document.getElementById('cors-test');
            const testUrl = 'https://www.bing.com/th?id=OHR.PlazaMayor_ZH-CN4576498488_1920x1200.jpg';
            
            try {
                const response = await fetch(testUrl, { mode: 'no-cors' });
                container.innerHTML = `
                    <div class="success">CORSæµ‹è¯•: è¯·æ±‚æˆåŠŸ (status: ${response.status})</div>
                    <div class="info">Response type: ${response.type}</div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="error">CORSæµ‹è¯•å¤±è´¥: ${error.message}</div>
                `;
            }
        }
        
        // æµ‹è¯•å ä½å›¾ç‰‡
        function testPlaceholder() {
            const container = document.getElementById('placeholder-test');
            container.innerHTML = `
                <div class="image-test">
                    <img src="/assets/images/placeholder.jpg" alt="å ä½å›¾ç‰‡æµ‹è¯•"
                         onload="logImageSuccess('placeholder', '/assets/images/placeholder.jpg')" 
                         onerror="logImageError('placeholder', '/assets/images/placeholder.jpg', this)">
                </div>
                <div id="placeholder-result" class="result">æµ‹è¯•ä¸­...</div>
            `;
        }
        
        // è®°å½•æˆåŠŸç»“æœ
        function logImageSuccess(type, url) {
            const resultDiv = document.getElementById(type + '-result') || 
                             document.getElementById('referrer-result');
            if (resultDiv) {
                resultDiv.innerHTML = `<div class="success">âœ… ${type} å›¾ç‰‡åŠ è½½æˆåŠŸ!</div>`;
            }
            console.log(`[${type}] å›¾ç‰‡åŠ è½½æˆåŠŸ:`, url);
        }
        
        // è®°å½•é”™è¯¯ç»“æœ
        function logImageError(type, url, imgElement) {
            const resultDiv = document.getElementById(type + '-result') || 
                             document.getElementById('referrer-result');
            if (resultDiv) {
                resultDiv.innerHTML = `<div class="error">âŒ ${type} å›¾ç‰‡åŠ è½½å¤±è´¥</div>`;
            }
            console.error(`[${type}] å›¾ç‰‡åŠ è½½å¤±è´¥:`, url, imgElement);
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            testBingImages();
            testReferrerPolicy();
            testCORS();
            testPlaceholder();
        });
    </script>
</body>
</html>
